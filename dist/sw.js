const CACHE_NAME="story-app-shell-v1";self.addEventListener("install",e=>{console.log("Service Worker: Installed"),self.skipWaiting()}),self.addEventListener("activate",e=>(console.log("Service Worker: Activated"),e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==CACHE_NAME)return caches.delete(e)})))),self.clients.claim())),self.addEventListener("fetch",e=>{"navigate"!==e.request.mode?"GET"===e.request.method&&e.respondWith(caches.match(e.request).then(t=>t||fetch(e.request).then(t=>caches.open(CACHE_NAME).then(s=>(s.put(e.request,t.clone()),t))))):e.respondWith(caches.match("/index.html",{ignoreSearch:!0}).then(t=>t||fetch(e.request).then(e=>caches.open(CACHE_NAME).then(t=>(t.put("/index.html",e.clone()),e))).catch(()=>caches.match("/index.html"))))}),self.addEventListener("push",e=>{console.log("[SW] Push Received:",e);let t={};try{t=e.data?e.data.json():{}}catch(e){console.error("Error parsing push event:",e),t={}}const s={body:t.message||"No message provided",icon:t.image||"/icons/icon-192.png",data:{id:t.id||""},actions:[{action:"open_detail",title:"Lihat Detail"}]};e.waitUntil(self.registration.showNotification(t.title||"Notifikasi Baru",s))});